.. _example_ccp4online_abinitio:

========================
Using *ab initio* models
========================

CCP4 online can be accessed through the :ref:`server tab <_server>`.

Obtaining models
================

You can obtain *ab initio* models for AMPLE from the `QUARK online server <http://zhanglab.ccmb.med.umich.edu/QUARK2>`_.

On the QUARK web server you will see an input page as follows:

.. figure:: ../images/quark_home_page.png
   :align: center

.. note::
    This requires a QUARK password - this can be obtained `here <http://zhanglab.ccmb.med.umich.edu/QUARK2/registration>`_.

Once QUARK has finished you will receive a link to a results:

.. figure:: ../images/quark_output.png
   :align: center

From this page you can download a tar.gz file containing the *ab initio* models generated by QUARK. This file can be directly supplied to AMPLE.

Running AMPLE
=============

AMPLE can be found on `CCP4 online <https://ccp4serv7.rc-harwell.ac.uk/ccp4online/>`_:

.. figure:: ../images/ccp4_online_home.png
   :align: center

Clicking on the AMPLE link will bring you to the following page:

.. figure:: ../images/ccp4_online_ample.png
   :align: center

This contains a list of any previous AMPLE jobs and allows you to submit new jobs.

Clicking on 'Click here to start a new AMPLE run' will bring you to the input page:

.. figure:: ../images/ccp4_online_input.png
   :align: center

Here you must submit:

1. The input structure factors
2. The input sequence
3. The path to the tar.gz file obtained from QUARK

.. note::
   You can also provide *ab initio* models obtained from other sources here

And then you can set the job running.

AMPLE Output
============
Upon submission you will have access to a results page summarising the progress of AMPLE and any results. The window will contain up to four tabs, the contents of which are explained below:

Summary
-------
The summary tab contains different sections. Below you can find information about each:

Ensembling Results
^^^^^^^^^^^^^^^^^^
.. figure:: ../images/ccp4_online_summary_ensembling.png
   :align: center

There is a brief summary of the type of truncation that was undertaken and then a table listing each ensemble. The columns of the table are:

* **Name:** the name of the ensemble. This is used to name the pdb file and the directory where mrbump carries out molecular replacement.
* **Truncation Level:** the percentage of the model remaining after the varying residues were pruned away.
* **Variance Threshold:** AMPLE constructs ensembles by pruning back the most variable residues based on their variance as calculated by THESEUS. The variance threshold is the THESEUS variance score for the most variable residue that remains in this ensemble.
* **No. Residues:** the number of residues for each model in the ensemble.
* **Radius Threshold:** the truncated models are sub-clustered after truncation under 3 different radius thresholds to create the ensemble, and this is the radius used for this sub-cluster.
* **No. Decoys:** the number of models within this ensemble.
* **Number of Atoms:** the number of atoms for each model in the ensemble.
* **Sidechain Treatment:**

  * *allatom* – all sidechains were retained
  * *reliable* – MET, ASP, PRO, GLN, LYS, ARG, GLU, SER were retained
  * *polyAla* – all sidechains were stripped back to polyalanine

MrBUMP Results
^^^^^^^^^^^^^^
This section displays a table with the results of running MrBUMP on each of the ensembles, for this example you will have information for the following headings.

.. figure:: ../images/ccp4_online_summary_mrbump.png
   :align: center

* **ensemble_name:** this matches the name from the ensemble section.
* **MR_program:** the program used for Molecular Replacement.
* **Solution type:** the MrBUMP categorisation of the solution

  * *GOOD* - final Rfree <=0.35
  * *MARGINAL* - final Rfree <= 0.48 OR final Rfree <= 0.5 and the ratio between the initial and final Rfree is <= 0.8, OR final Rfree <= 0.55 and the ratio between the initial and final Rfree is <= 0.95
  * *POOR* - anything else
  * *no_job_directory* - a script has been prepared, but the job hasn’t been run yet
  * *unfinished* - the job is running or has stopped without generating any results

* **PHASER_LLG:** the PHASER log-likelihood gain for the Molecular Replacement solution.
* **PHASER_TFZ:** PHASER Translation Function Z-score for the Molecular Replacement solution.
* **REFMAC_Rfact:** Rfact score for REFMAC refinement of the Molecular Replacement solution.
* **REFMAC_Rfree:** Rfree score for REFMAC refinement of the Molecular Replacement solution.
* **SHELXE_CC:** SHELXE Correlation Coefficient score after C-alpha trace.
* **SHELXE_ACL:** Average Chain Length of the fragments of the SHELXE C-alpha trace.

Results
-------
The Results tab displays the final results of AMPLE after running MrBUMP on the ensembles.

.. figure:: ../images/ccp4_online_results.png
   :align: center

The tab is split into two sections. The upper section shows the top three results as ranked by their SHELXE CC score. The lower section shows the top three results as ranked by their PHASER TFZ score. These may or may not be different. Within each section, the left-hand menu displays a list of ensemble names – these match the names from the Ensembles section in the Summary tab. Clicking on any item will display the results for that ensemble in the central pane. At the top is a table that matches the MrBUMP entry from the Summary tab, and there are then sections for the files output by each program run by MrBUMP. The files can either be displayed directly or opened directly with COOT or CCP4MG using the displayed buttons.

Typically a result with a SHELXE CC score of 25 or higher **and** a SHELXE ACL of 10 or higher will indicate a correct solution.

.. note::
   The results you obtain may be slightly different to those presented above as you are generating a new slightly different set of *ab initio* models.


Log File
--------
This displays the text output by AMPLE as it is running. Any problems or errors will be displayed here.

.. figure:: ../images/ccp4_online_log.png
   :align: center

Citations
---------
This section lists the programs and algoriths that are using in the AMPLE job and gives a list of references to be cited should AMPLE find a solution.

.. figure:: ../images/ccp4_online_citation.png
   :align: center


